<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn-icons-png.flaticon.com/512/1384/1384031.png" rel="shortcut icon" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/storyService/editpage.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    
    <title>MZTALK</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <nav>
        <div class="navContainer">
            <article class="logoWrap">
                <img src="https://cdn-icons-png.flaticon.com/512/1384/1384031.png" onclick="moveMainPage();" alt="로고">
                <div class="columnLine"></div>
                <h1 class="logo" onclick="moveMainPage();">MZTALK</h1>
            </article>
            <!-- <article class="search">
                <input type="text" placeholder="검색" >
            </article> -->
            <article class="pictogramWrap">
                
                <i class="fa-solid fa-comments" style=""></i>
                <img src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/bearu/profile.png" alt="프로필" id="move-story-service">
            </article>
        </div>
    </nav>
   <!-- 여기서 놀아주세요. -->
    <main class="mainContainer">

        <div class="_ab81 _ab82">
            <div class="d-flex align-items-start">
                <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                  <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">프로필 설정</button>
                  <button class="nav-link hidden" id="v-pills-profile-tab" data-bs-toggle="pill" data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile" aria-selected="false" >비밀번호 변경</button>
                  <button class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill" data-bs-target="#v-pills-messages" type="button" role="tab" aria-controls="v-pills-messages" aria-selected="false" onclick="myReport();">신고 조회</button>
                  <button class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill" data-bs-target="#v-pills-settings" type="button" role="tab" aria-controls="v-pills-settings" aria-selected="false">구독권</button>
                  
                </div>
                <div class="tab-content" id="v-pills-tabContent">
                  <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab" tabindex="0">
                    
                    <section class="setting-container">
                        <!--프로필셋팅 아티클-->
                        <article class="setting__content">
                
                            <!--프로필셋팅 아이디영역-->
                            <div class="content-item__01">
                                <div class="profile-left">
                                    <div class="profile-img-wrap story-border">
                                        <!-- <form id="userProfileImageForm">
                                            <input type="file" name="profileImageFile" style="display: none;"
                                                id="userProfileImageInput" />
                                        </form> -->
                        
                                        <!-- <img class="profile-image" src="img/instagram_feed.jpg"
                                             id="userProfileImage" /> -->
                                    </div>
                                </div>
                                <div class="item__username">
                                    <h2>MZTALK</h2>
                                </div>
                            </div>
                            <!--프로필셋팅 아이디영역end-->
                            <!--프로필 사진 수정시에 바로 DB에 저장되게끔-->
                            <!--프로필 수정-->
                            <form id="profileUpdate">
                                <div class="content-item__02">
                                    <div class="item__title">닉네임</div>
                                    <div class="item__input">
                                        <input type="text" name="name" placeholder="닉네임" id="nickname" class="own_name" />
                                        <div id="checkNickname" class="vaild-div"></div>
                                        <input type="hidden" id="checkNicknameResult" value="fail"/>
                                    </div>
                                        
                                </div>
                                
                                <div class="content-item__11">
                                    <div class="item__title"></div>
                                    <div class="item__input">

                                        <button type="button" class="btn btn-primary" id="nickname_check" onclick="ch_nickName();" disabled="disabled">제출</button>
                                    </div>
                                </div>

                                <div class="content-item__07">
                                    <div class="item__title"></div>
                                    <div class="item__input">
                                        <span><b>개인정보</b></span> 
                                        <span>
                                            비즈니스나 반려동물 등에 사용된 계정인 경우에도
                                            회원님의 개인 정보를 입력하세요. 공개 프로필에는 포함되지 않습니다.
                                        </span>
                                    </div>
                                </div>
                                <!-- <div class="content-item__08">
                                    <div class="item__title">이메일</div>
                                    <div class="item__input">
                                        <input type="text" name="email" placeholder="이메일"
                                           id="email-box"/>
                                           <div id="checkEmail"  class="vaild-div"></div>
                                           <input type="hidden" id="checkEmailResult" value="fail"/>
                                        <br>    
                                        <button class="btn btn-primary" type="button" id="email_check">인증번호 전송</button>    
                                        <br>    
                                        <input type="text" name="email" placeholder="인증번호"
                                        style="width:280px" id="auth-box"/> 
                                        <div id="checkAuth"  class="vaild-div"></div>
                                        <input type="hidden" id="checkAuthResult" value="fail"/>
                                          
                                    </div>
                                </div>
                                
                                제출버튼
                                <div class="content-item__11">
                                    <div class="item__title"></div>
                                    <div class="item__input">
                                        <button type="button" class="btn btn-primary" id="final_check" onclick="ch_email();" disabled="disabled">이메일변경</button>
                                    </div>
                                </div> -->
                                
                                <!--제출버튼end-->
                            </form>
                            <!--프로필수정 form end-->
                        </article>
                    </section>



                    

                    <div class="col-0.5">
                        &nbsp;<!--공백-->
                    </div> 

                    <form id="alarmsEdit">
                        <div class="alarms">
                        <div class="content-item_01">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" checked>
                                <div class="item__title">멘토/멘티</div>
                            </div>
                        </div>
                        
                        <div class="content-item_02">
                            
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch"checked>
                                <div class="item__title">벙</div>
                            </div>
                        </div>

                        <div class="content-item_03">
                            
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch"checked>
                                <div class="item__title">경매</div>
                            </div>
                        </div>
                        
                        </div>
                        
                        <!--제출버튼end-->
                    </form>
                  </div>

                 


                  <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab" tabindex="0">
                   
                    <section class="setting-container">
                        <!--프로필셋팅 아티클-->
                        <article class="setting__content">
                            
                            <!--비밀번호 수정-->
                            <form id="passwordEdit">
                                <div class="content-item__04">
                                    <div class="item__title">이전 비밀번호</div>
                                    <div class="item__input">
                                        <input type="password" id="passwd" name="current-password" autocomplete="off" placeholder="이전 비밀번호"
                                            />
                                    </div>
                                </div>
                                
                                <div class="content-item__05">
                                    <div class="item__title">새 비밀번호</div>
                                    <div class="item__input">
                                        <input type="password" id="password" placeholder="새 비밀번호"/>
                                        <div id="checkPw"  class="vaild-div"></div>
                                        <input type="hidden" id="checkPasswordResult" value="fail"/>
                                    </div>
                                </div>

                                <div class="content-item__06">
                                    <div class="item__title">새 비밀번호 확인</div>
                                    <div class="item__input">
                                        <input type="password" id="re_password" placeholder="새 비밀번호 확인"/>
                                        <div id="checkRePw"  class="vaild-div"></div>
                                        <input type="hidden" id="checkRePasswordResult" value="fail"/>
                                    </div>
                                </div>
                                
                                <!--제출버튼-->
                                <div class="content-item__11">
                                    <div class="item__title"></div>
                                    <div class="item__input">
                                        <button id="password_button_check" onclick="ch_Password();" type="button" class="btn btn-primary" disabled>제출</button>
                                    </div>
                                </div>
                                
                                <!--제출버튼end-->


                                <div class="content-item__08">
                                    <div class="item__title">이메일</div>
                                    <div class="item__input">
                                        <input type="text" name="email" placeholder="이메일"
                                           id="email-box"/>
                                           <div id="checkEmail"  class="vaild-div"></div>
                                           <input type="hidden" id="checkEmailResult" value="fail"/>
                                        <br>    
                                        <button class="btn btn-primary" type="button" id="email_check">인증번호 전송</button>    
                                        <br>    
                                        <input type="text" name="email" placeholder="인증번호"
                                        style="width:280px" id="auth-box"/> 
                                        <div id="checkAuth"  class="vaild-div"></div>
                                        <input type="hidden" id="checkAuthResult" value="fail"/>
                                          
                                    </div>
                                </div>
                                
                                <!--제출버튼-->
                                <div class="content-item__11">
                                    <div class="item__title"></div>
                                    <div class="item__input">
                                        <button type="button" class="btn btn-primary" id="final_check" onclick="ch_email();" disabled="disabled">이메일변경</button>
                                    </div>
                                </div>





                            </form>
                            <!--프로필수정 form end-->
                        </article>
                    </section>


                     
                </div>
                  <div class="tab-pane fade" id="v-pills-disabled" role="tabpanel" aria-labelledby="v-pills-disabled-tab" tabindex="0">
                    
                </div>
                  <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab" tabindex="0">
                   
                    <div class="setting-declarations">
                        <!--프로필셋팅 아티클-->
                        
                            <div>신고 당한 글</div>
                            <div class="col-0.5">
                                &nbsp;<!--공백-->
                            </div>

                                <div id="reportAllList">
                                 <!-- <div id="reportAllList"> -->
                                    <!--리스트 뿌려주는곳-->
                                     <!-- <div class="card mb-3" style="max-width: 750px;">
                                        <div class="row g-0">
                                        <div class="col-md-4">
                                            <img src="img/instagram_feed.jpg" class="img-fluid rounded-start" alt="...">
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                            <h5 class="card-title">신고글제목</h5>
                                            <span class="badge text-bg-primary" id="serviceMetors">멘토</span>
                                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                                            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                            </div>
                                        </div>
                                        </div>
                                    </div> -->

                                    <!-- <div class="card mb-3" style="max-width: 750px;">
                                        <div class="row g-0">
                                        <div class="col-md-4">
                                            <img src="img/instagram_feed.jpg" class="img-fluid rounded-start" alt="...">
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                            <h5 class="card-title">신고글제목</h5>
                                            <span class="badge text-bg-primary" id="serviceMetors">멘토</span>
                                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                                            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                            </div>
                                        </div>
                                        </div>
                                    </div>


                                    <div class="card mb-3" style="max-width: 750px;">
                                        <div class="row g-0">
                                        <div class="col-md-4">
                                            <img src="img/instagram_feed.jpg" class="img-fluid rounded-start" alt="...">
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                            <h5 class="card-title">Card title</h5>
                                            <span class="badge text-bg-info" id="serviceBung">벙</span>
                                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                                            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card mb-3" style="max-width: 750px;">
                                        <div class="row g-0">
                                        <div class="col-md-4">
                                            <img src="img/instagram_feed.jpg" class="img-fluid rounded-start" alt="...">
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                            <h5 class="card-title">Card title</h5>
                                            <span class="badge text-bg-success" id="serviceAuction">경매</span>
                                            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                                            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                            </div>
                                        </div>
                                        </div>
                                    </div> -->









                                </div>
                                <!-- </div> -->
                    </div>  


                        
                </div>
                  <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab" tabindex="0">
                    
                    <section class="setting-subsribe">

                        <!--프로필셋팅 아티클-->
                        <article class="setting__subsribe">

                            <!--프로필셋팅 아이디영역-->
                            <div class="content-item__01">
                                <form>    
                                    <button onclick="requestPay();" type="button" id="subscribe_" class="btn btn-outline-primary">
                                        <p>
                                            <h1>정기 구독하기</h1>
                                            <h4>월 9,900원</h4>
                                        </p>
                                    </button>
                                </form> 
                                   
                            </div>
                            <div id="vipDate">

                                
                            </div>
                        </article>
                    </section>       
                    
                    </div>

                </div>
              </div>
        </div>






























           
    </main>

    <div class="floating">
        <div class="remocon">
            <figure><img src="img/mento.png" style="width: 70px; margin-bottom: 25px; margin-top: 25px;" id="move-mentor-service"/></figure>
           
            <figure> <img src="img/qjd.png" style="width: 70px;" id="move-bung-service"/></figure>
            
            <figure>  <img src="img/book.png" style="width: 70px; margin-top:30px;" id="move-auction-service"/></figure>
            

            <!-- <figure><i class="fa-solid fa-comments" style="width: 85px;"></i></figure> -->
        </div>


        <div class="side side1"></div>
        <div class="side side2"></div>
        <div class="side side3"></div>
        <div class="side side4"></div>
    </div>

    <!-- <div id="upBtn">
        <a href="#"><figure id="up-figure"><img src="img/top.png" style="width: 40px;"/></figure></a>
    
    </div>  -->

    <div id="upBtn">
          <a href="#"><figure><img src="img/top.png" style="width: 50px;"/></figure></a>
    </div>
    <footer>
        <div class="container">
            <ul>
               <li><a href="#a">소개</a></li>
               <li><a href="#a">블로그</a></li>
               <li><a href="#a">채용 정보</a></li>
               <li><a href="#a">도움말</a></li>
               <li><a href="#a">API</a></li>
               <li><a href="#a">개인정보처리방침</a></li>
               <li><a href="#a">약관</a></li>
               <li><a href="#a">인기 계정</a></li>
               <li><a href="#a">해시태그</a></li>
               <li><a href="#a">위치</a></li>
            </ul>
            <div class="copy">
               <p>© 2022 MZTALK from Spring</p>
            </div>
         </div>
      
         <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">Toggle right offcanvas</button>
       </footer>
   
     <!--프로필사진 바꾸기 모달-->
     <!-- <div class="modal-image" onclick="modalImage()">
        <div class="modal">
            <p>프로필 사진 바꾸기</p>
            <button onclick="profileImageUpload()">사진 업로드</button>
            <button onclick="closePopup('.modal-image')">취소</button>
        </div>
    </div> -->

    <!--프로필사진 바꾸기 모달end-->
    

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasRightLabel">Offcanvas right</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        ...
    </div>
    </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
</body>
<script src="JS/main.js"></script>
<script src="JS/personal/editpage.js"></script>


 <!-- 제이쿼리 -->
 <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
 <!-- 아임포트 -->
 <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>


   <!-- 아임포트 결제 스크립트-->
   <script type="text/javascript">
    let role = localStorage.getItem('role');
    console.log(role);
    const random = Math.ceil(Math.random()*100000000);

    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth()+1;
    const date = today.getDate();

    
    const IMP = window.IMP; 
    IMP.init("imp43500426");
    let userNo = localStorage.getItem('userNo');
    //아임포트 결제
    function requestPay() {
    
        if(role.includes('ROLE_VIP')){
            alert("이미 VIP회원이십니다.");
            return;
        }
        

        IMP.request_pay({
                pg: "html5_inicis",
                pay_method: "card",
                merchant_uid: "ORD"+ year + month + date +  "-" + random,
                name: "mztalk",
                amount: 100,
                buyer_email: 'nowing0108@gmail.com',
                buyer_name: localStorage.getItem('username'), 
                buyer_tel: '01074402770',
            },
        function (rsp) {
            if (rsp.success) {
               $.ajax({
                    url: "http://localhost:8000/story/subscribe",
                    method:"POST",
                    headers: {
                        "Content-Type": "application/json;",
                        Authorization:localStorage.getItem('authorization'),
                        RefreshToken:localStorage.getItem('refreshToken')
                    },
                    data: JSON.stringify({
                        userNo : localStorage.getItem('userNo'),
                        price : rsp.paid_amount,
                        vipDate : today.setMonth(month),                        
                    })                    
               })    
               .done(function(data){
                    $.ajax({
                        url: "http://localhost:8000/login/role/vip/"+userNo,
                        method: "PATCH",
                        headers: {
                            "Content-Type": "application/json;",
                            Authorization:localStorage.getItem('authorization'),
                            RefreshToken:localStorage.getItem('refreshToken')
                        },
                        data: JSON.stringify({
                            userNo : localStorage.getItem('userNo'),
                        })
                    })
                    alert('vip등급이 되었습니다. 다시 로그인해주세요');
                    logout();
               })
            } else {
                alert('결제를 실패하셨습니다');
                location.href="editpage.html";
            }
        });
    }



//로그아웃
function logout(){

localStorage.clear();

deleteCookie('Authorization');
deleteCookie('RefreshToken');

location.href="loginpage.html";
}

//쿠키삭제
function deleteCookie(name) {
document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
}

</script>
</html>